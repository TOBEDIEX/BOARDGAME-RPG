-- ItemData.lua
-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏Å‡∏° (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï)
-- Version: 2.0.0 - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å MaxHP ‡πÄ‡∏õ‡πá‡∏ô DEF ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° Defense Items

-- Constants
local ITEM_TYPES = {
	GENERAL = 1,    -- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
	EQUIPMENT = 2,  -- ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏£‡∏≤‡∏∞
	SKILL = 3,      -- ‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå‡∏™‡∏Å‡∏¥‡∏•
	SPECIAL = 4     -- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©/‡πÄ‡∏Ñ‡∏ß‡∏™
}

local EQUIPMENT_SLOTS = {
	WEAPON = 1,
	HELMET = 2,
	ARMOR = 3,
	GLOVES = 4,
	BOOTS = 5,
	ACCESSORY = 6
}

local ItemData = {}

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡πÄ‡∏ó‡∏° (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢ InventoryService)
ItemData.UseHandlers = ItemData.UseHandlers or {}

-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏° Defense Boost
ItemData.Items = {
	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏î‡∏¥‡∏°
	test_item = {
		id = "test_item",
		name = "Test Item",
		description = "This is a test item for inventory system.",
		type = ITEM_TYPES.GENERAL,
		rarity = 1,
		stackable = true,
		maxStack = 99,
		sellPrice = 10,
		buyPrice = 20,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://6675226918",
		stats = {
			hp = 50
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏ï‡πã‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏° +1
	dice_bonus_1 = {
		id = "dice_bonus_1",
		name = "BonusDice +1",
		description = "Add your dice 1",
		type = ITEM_TYPES.GENERAL,
		rarity = 2,
		stackable = true,
		maxStack = 5,
		sellPrice = 100,
		buyPrice = 300,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://122493284803076", -- ‡∏£‡∏π‡∏õ‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
		stats = {
			diceRollBonus = 1
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏ï‡πã‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏° +2
	dice_bonus_2 = {
		id = "dice_bonus_2",
		name = "BonusDice +2",
		description = "Add your Dice 2",
		type = ITEM_TYPES.GENERAL,
		rarity = 3,
		stackable = true,
		maxStack = 3,
		sellPrice = 250,
		buyPrice = 600,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://106756897158809", -- ‡∏£‡∏π‡∏õ‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
		stats = {
			diceRollBonus = 2
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏¢‡∏≤‡∏ü‡∏∑‡πâ‡∏ô‡∏û‡∏•‡∏±‡∏á
	health_potion = {
		id = "health_potion",
		name = "Health Potion",
		description = "‡∏ü‡∏∑‡πâ‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 50 ‡∏´‡∏ô‡πà‡∏ß‡∏¢",
		type = ITEM_TYPES.GENERAL,
		rarity = 1,
		stackable = true,
		maxStack = 10,
		sellPrice = 50,
		buyPrice = 150,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://7060145106", -- ‡∏£‡∏π‡∏õ‡∏Ç‡∏ß‡∏î‡∏¢‡∏≤
		stats = {
			hp = 50
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
	mana_potion = {
		id = "mana_potion",
		name = "Mana Potion",
		description = "‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó 30 ‡∏´‡∏ô‡πà‡∏ß‡∏¢",
		type = ITEM_TYPES.GENERAL,
		rarity = 1,
		stackable = true,
		maxStack = 10,
		sellPrice = 60,
		buyPrice = 180,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://7060145299", -- ‡∏£‡∏π‡∏õ‡∏Ç‡∏ß‡∏î‡∏¢‡∏≤
		stats = {
			mp = 30
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏≥‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô +3
	defense_scroll = {
		id = "defense_scroll",
		name = "Defense Scroll",
		description = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (DEF) ‡∏ñ‡∏≤‡∏ß‡∏£ +3",
		type = ITEM_TYPES.GENERAL,
		rarity = 2,
		stackable = true,
		maxStack = 5,
		sellPrice = 200,
		buyPrice = 500,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://7060146509", -- ‡∏£‡∏π‡∏õ‡∏ï‡∏≥‡∏£‡∏≤
		stats = {
			defensePermanent = 3
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏≥‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ +3
	attack_scroll = {
		id = "attack_scroll",
		name = "Attack Scroll",
		description = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ (ATK) ‡∏ñ‡∏≤‡∏ß‡∏£ +3",
		type = ITEM_TYPES.GENERAL,
		rarity = 2,
		stackable = true,
		maxStack = 5,
		sellPrice = 200,
		buyPrice = 500,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://7060146202", -- ‡∏£‡∏π‡∏õ‡∏ï‡∏≥‡∏£‡∏≤
		stats = {
			attackPermanent = 3
		}
	},

	-- ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏≥‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó +3
	magic_scroll = {
		id = "magic_scroll",
		name = "Magic Scroll",
		description = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó (MAGIC) ‡∏ñ‡∏≤‡∏ß‡∏£ +3",
		type = ITEM_TYPES.GENERAL,
		rarity = 2,
		stackable = true,
		maxStack = 5,
		sellPrice = 200,
		buyPrice = 500,
		usable = true,
		consumable = true,
		iconId = "rbxassetid://7060146799", -- ‡∏£‡∏π‡∏õ‡∏ï‡∏≥‡∏£‡∏≤
		stats = {
			magicPermanent = 3
		}
	}
}

-- ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö DEF
ItemData.Equipment = {
	-- ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö
	test_equipment = {
		id = "test_equipment",
		name = "Test Equipment",
		description = "This is a test equipment for inventory system.",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.WEAPON,
		rarity = 2,
		stackable = false,
		maxStack = 1,
		sellPrice = 100,
		buyPrice = 300,
		usable = false,
		iconId = "rbxassetid://6675226140",
		stats = {
			attack = 10,
			defense = 5
		}
	},

	-- ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏£‡∏ö
	bronze_sword = {
		id = "bronze_sword",
		name = "Bronze Sword",
		description = "‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏£‡∏ö",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.WEAPON,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 50,
		buyPrice = 150,
		usable = false,
		iconId = "rbxassetid://6675226240",
		classRestriction = "Warrior",
		stats = {
			attack = 15,
			defense = 3 -- ‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡πÅ‡∏ó‡∏ô ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° MaxHP ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
		}
	},

	-- ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ß‡∏ó‡∏¢‡πå
	apprentice_staff = {
		id = "apprentice_staff",
		name = "Apprentice Staff",
		description = "‡πÑ‡∏°‡πâ‡πÄ‡∏ó‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.WEAPON,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 50,
		buyPrice = 150,
		usable = false,
		iconId = "rbxassetid://6675226399",
		classRestriction = "Mage",
		stats = {
			attack = 5,
			magic = 15,
			defense = 2 -- ‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡πÅ‡∏ó‡∏ô ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° MaxHP ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
		}
	},

	-- ‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πÇ‡∏°‡∏¢
	bronze_dagger = {
		id = "bronze_dagger",
		name = "Bronze Dagger",
		description = "‡∏Å‡∏£‡∏¥‡∏ä‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏≤ ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡πÅ‡∏ï‡πà‡∏û‡∏•‡∏±‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ô‡πâ‡∏≠‡∏¢",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.WEAPON,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 50,
		buyPrice = 150,
		usable = false,
		iconId = "rbxassetid://6675226485",
		classRestriction = "Thief",
		stats = {
			attack = 10,
			magic = 5,
			defense = 1 -- ‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡πÅ‡∏ó‡∏ô ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° MaxHP ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
		}
	},

	-- ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
	leather_armor = {
		id = "leather_armor",
		name = "Leather Armor",
		description = "‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏ö‡∏≤ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.ARMOR,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 40,
		buyPrice = 120,
		usable = false,
		iconId = "rbxassetid://6675226750",
		stats = {
			maxHp = 10 
		}
	},

	-- ‡∏´‡∏°‡∏ß‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
	leather_helmet = {
		id = "leather_helmet",
		name = "Leather Helmet",
		description = "‡∏´‡∏°‡∏ß‡∏Å‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏ö‡∏≤ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.HELMET,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 30,
		buyPrice = 90,
		usable = false,
		iconId = "rbxassetid://6675226899",
		stats = {
			defense = 5 -- ‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡πÅ‡∏ó‡∏ô ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° MaxHP ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
		}
	},

	-- ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
	leather_boots = {
		id = "leather_boots",
		name = "Leather Boots",
		description = "‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏ö‡∏≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß",
		type = ITEM_TYPES.EQUIPMENT,
		subType = EQUIPMENT_SLOTS.BOOTS,
		rarity = 1,
		stackable = false,
		maxStack = 1,
		sellPrice = 25,
		buyPrice = 75,
		usable = false,
		iconId = "rbxassetid://6675226910",
		stats = {
			defense = 3 -- ‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡πÅ‡∏ó‡∏ô ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° MaxHP ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
		}
	}
}

-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á Item
ItemData.ItemTilePool = {
	-- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏° (‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
	{id = "health_potion", weight = 40},   -- 40%
	{id = "mana_potion", weight = 30},     -- 30%  
	{id = "dice_bonus_1", weight = 20},    -- 20%
	{id = "defense_scroll", weight = 4},   -- 4%
	{id = "attack_scroll", weight = 3},    -- 3%
	{id = "magic_scroll", weight = 2},     -- 2%
	{id = "dice_bonus_2", weight = 1}      -- 1%
}

-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å ID
function ItemData.GetItemById(itemId)
	-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
	if ItemData.Items[itemId] then
		return ItemData.Items[itemId]
	end

	-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
	if ItemData.Equipment[itemId] then
		return ItemData.Equipment[itemId]
	end

	return nil
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
function ItemData.GetItemsByType(itemType)
	local result = {}

	-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
	for id, item in pairs(ItemData.Items) do
		if item.type == itemType then
			table.insert(result, item)
		end
	end

	-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
	for id, item in pairs(ItemData.Equipment) do
		if item.type == itemType then
			table.insert(result, item)
		end
	end

	return result
end

-- ‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å ItemTilePool
function ItemData.GetRandomItemFromPool()
	local totalWeight = 0
	for _, itemInfo in ipairs(ItemData.ItemTilePool) do
		totalWeight = totalWeight + itemInfo.weight
	end

	local randomValue = math.random(1, totalWeight)
	local currentWeight = 0

	for _, itemInfo in ipairs(ItemData.ItemTilePool) do
		currentWeight = currentWeight + itemInfo.weight
		if randomValue <= currentWeight then
			return ItemData.GetItemById(itemInfo.id)
		end
	end

	-- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)
	return ItemData.GetItemById("health_potion")
end

-- ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
ItemData.ITEM_TYPES = ITEM_TYPES
ItemData.EQUIPMENT_SLOTS = EQUIPMENT_SLOTS

-- ====== ‡πÄ‡∏û‡∏¥‡πà‡∏° UseHandlers ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏° DiceBonus ======

-- Lucky Dice +1
ItemData.UseHandlers.dice_bonus_1 = function(player, itemData)
	-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	local turnSystem = _G.GameManager and _G.GameManager.turnSystem
	if not turnSystem then
		return false, "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
	end

	if turnSystem:GetCurrentPlayerTurn() ~= player.UserId then
		return false, "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"
	end

	-- ‡πÅ‡∏à‡πâ‡∏á client ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
	local remotes = game:GetService("ReplicatedStorage"):WaitForChild("Remotes")
	local inventoryRemotes = remotes:WaitForChild("InventoryRemotes")
	local diceBonusEvent = inventoryRemotes:FindFirstChild("DiceBonus")

	if not diceBonusEvent then
		diceBonusEvent = Instance.new("RemoteEvent")
		diceBonusEvent.Name = "DiceBonus"
		diceBonusEvent.Parent = inventoryRemotes
	end

	-- ‡∏™‡πà‡∏á‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÑ‡∏õ‡∏¢‡∏±‡∏á client
	diceBonusEvent:FireClient(player, 1)

	-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
	local message = "üé≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ +1 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ!"

	-- ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
	pcall(function()
		local soundService = game:GetService("SoundService")
		local sound = soundService:FindFirstChild("ItemUse") or Instance.new("Sound", soundService)
		sound.Name = "ItemUse"
		sound.SoundId = "rbxassetid://6895079853"
		sound.Volume = 0.7
		sound:Play()
	end)

	return true, message
end

-- Magical Dice +2
ItemData.UseHandlers.dice_bonus_2 = function(player, itemData)
	-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	local turnSystem = _G.GameManager and _G.GameManager.turnSystem
	if not turnSystem then
		return false, "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
	end

	if turnSystem:GetCurrentPlayerTurn() ~= player.UserId then
		return false, "‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"
	end

	-- ‡πÅ‡∏à‡πâ‡∏á client ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
	local remotes = game:GetService("ReplicatedStorage"):WaitForChild("Remotes")
	local inventoryRemotes = remotes:WaitForChild("InventoryRemotes")
	local diceBonusEvent = inventoryRemotes:FindFirstChild("DiceBonus")

	if not diceBonusEvent then
		diceBonusEvent = Instance.new("RemoteEvent")
		diceBonusEvent.Name = "DiceBonus"
		diceBonusEvent.Parent = inventoryRemotes
	end

	-- ‡∏™‡πà‡∏á‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÑ‡∏õ‡∏¢‡∏±‡∏á client
	diceBonusEvent:FireClient(player, 2)

	-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
	local message = "üé≤‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ +2 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ!"

	-- ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏ß‡πà‡∏≤ +1)
	pcall(function()
		local soundService = game:GetService("SoundService")
		local sound = soundService:FindFirstChild("MagicItemUse") or Instance.new("Sound", soundService)
		sound.Name = "MagicItemUse"
		sound.SoundId = "rbxassetid://6026984224"
		sound.Volume = 0.7
		sound:Play()
	end)

	return true, message
end

-- Defense Scroll (‡πÄ‡∏û‡∏¥‡πà‡∏° DEF ‡∏ñ‡∏≤‡∏ß‡∏£)
ItemData.UseHandlers.defense_scroll = function(player, itemData)
	-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö ClassSystem ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	local gameManager = _G.GameManager
	local playerManager = gameManager and gameManager.playerManager

	if not playerManager then
		return false, "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
	end

	-- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	local playerData = playerManager:GetPlayerData(player)
	if not playerData then
		return false, "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô"
	end

	-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ Defense ‡∏ñ‡∏≤‡∏ß‡∏£
	local defBonus = itemData.stats.defensePermanent or 3

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ defense ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	playerData.stats.defense = playerData.stats.defense + defBonus
	playerData.stats.maxHp = playerData.stats.defense  -- MaxHP = Defense

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô baseStats ‡∏î‡πâ‡∏ß‡∏¢
	if playerData.baseStats then
		playerData.baseStats.defense = playerData.baseStats.defense + defBonus
		playerData.baseStats.maxHp = playerData.baseStats.defense
	end

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ HP ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏° maxHp ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô
	playerData.stats.hp = playerData.stats.hp + defBonus

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Humanoid
	if player.Character and player.Character:FindFirstChild("Humanoid") then
		local humanoid = player.Character:FindFirstChild("Humanoid")
		humanoid.MaxHealth = playerData.stats.maxHp
		humanoid.Health = humanoid.Health + defBonus
	end

	-- ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á client
	playerManager:SyncPlayerStats(player)

	-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
	local message = "üõ°Ô∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (DEF) ‡∏ñ‡∏≤‡∏ß‡∏£ +" .. defBonus .. " (‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢)"

	-- ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
	pcall(function()
		local soundService = game:GetService("SoundService")
		local sound = soundService:FindFirstChild("StatUpSound") or Instance.new("Sound", soundService)
		sound.Name = "StatUpSound"
		sound.SoundId = "rbxassetid://9114835652"
		sound.Volume = 0.8
		sound:Play()
	end)

	return true, message
end

-- Attack Scroll (‡πÄ‡∏û‡∏¥‡πà‡∏° ATK ‡∏ñ‡∏≤‡∏ß‡∏£)
ItemData.UseHandlers.attack_scroll = function(player, itemData)
	-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö ClassSystem ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	local gameManager = _G.GameManager
	local playerManager = gameManager and gameManager.playerManager

	if not playerManager then
		return false, "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
	end

	-- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	local playerData = playerManager:GetPlayerData(player)
	if not playerData then
		return false, "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô"
	end

	-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ Attack ‡∏ñ‡∏≤‡∏ß‡∏£
	local atkBonus = itemData.stats.attackPermanent or 3

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ attack ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	playerData.stats.attack = playerData.stats.attack + atkBonus

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô baseStats ‡∏î‡πâ‡∏ß‡∏¢
	if playerData.baseStats then
		playerData.baseStats.attack = playerData.baseStats.attack + atkBonus
	end

	-- ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á client
	playerManager:SyncPlayerStats(player)

	-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
	local message = "‚öîÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ (ATK) ‡∏ñ‡∏≤‡∏ß‡∏£ +" .. atkBonus

	-- ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
	pcall(function()
		local soundService = game:GetService("SoundService")
		local sound = soundService:FindFirstChild("StatUpSound") or Instance.new("Sound", soundService)
		sound.Name = "StatUpSound"
		sound.SoundId = "rbxassetid://9114835652"
		sound.Volume = 0.8
		sound:Play()
	end)

	return true, message
end

-- Magic Scroll (‡πÄ‡∏û‡∏¥‡πà‡∏° MAGIC ‡∏ñ‡∏≤‡∏ß‡∏£)
ItemData.UseHandlers.magic_scroll = function(player, itemData)
	-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö ClassSystem ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	local gameManager = _G.GameManager
	local playerManager = gameManager and gameManager.playerManager

	if not playerManager then
		return false, "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
	end

	-- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	local playerData = playerManager:GetPlayerData(player)
	if not playerData then
		return false, "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô"
	end

	-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ Magic ‡∏ñ‡∏≤‡∏ß‡∏£
	local magicBonus = itemData.stats.magicPermanent or 3

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ magic ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
	playerData.stats.magic = playerData.stats.magic + magicBonus

	-- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô baseStats ‡∏î‡πâ‡∏ß‡∏¢
	if playerData.baseStats then
		playerData.baseStats.magic = playerData.baseStats.magic + magicBonus
	end

	-- ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á client
	playerManager:SyncPlayerStats(player)

	-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
	local message = "‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå (MAGIC) ‡∏ñ‡∏≤‡∏ß‡∏£ +" .. magicBonus

	-- ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
	pcall(function()
		local soundService = game:GetService("SoundService")
		local sound = soundService:FindFirstChild("StatUpSound") or Instance.new("Sound", soundService)
		sound.Name = "StatUpSound"
		sound.SoundId = "rbxassetid://9114835652"
		sound.Volume = 0.8
		sound:Play()
	end)

	return true, message
end

return ItemData
